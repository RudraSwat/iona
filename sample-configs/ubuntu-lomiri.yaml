name: 'Ubuntu Lomiri'

codename: 'noble'

repos:
    - url: 'http://archive.ubuntu.com/ubuntu'
      components:
        - 'main'
        - 'universe'
        - 'multiverse'
        - 'restricted'
      suites:
        - 'noble'
        - 'noble-updates'
      deb-src: false

    - url: 'http://security.ubuntu.com/ubuntu'
      components:
        - 'main'
        - 'universe'
        - 'multiverse'
        - 'restricted'
      suites:
        - 'noble-security'
      deb-src: false

packages:
    - type: 'deb'
      list:
        - 'dpkg-dev'
        - 'lightdm'
        - 'lomiri'
        - 'lomiri-greeter'
        - 'ubiquity-casper'
        - 'ubiquity-frontend-gtk'
        - 'ubiquity-slideshow-ubuntu'
        - 'software-properties-common'
        - 'network-manager'
        - 'sddm'
        - 'xwayland'

    - type: 'snap'
      list:
        - 'core'
        - 'core18'
        - 'core20'
        - 'core22'
        - 'bare'
        - 'snapd'
        - 'gnome-42-2204'
        - 'gtk-common-themes'
        - 'firefox'

workarounds:
    - name: 'ubuntu-network'

    - name: 'command'
      command: 'echo "[Autologin]" > /etc/sddm.conf'
    - name: 'command'
      command: 'echo "User=ubuntu" >> /etc/sddm.conf'
    - name: 'command'
      command: 'echo "Session=lomiri" >> /etc/sddm.conf'
    - name: 'command'
      command: ['mkdir', '-p', '/etc/systemd/user/lomiri.service.d']
    - name: 'command'
      command: 'echo "[Service]" > /etc/systemd/user/lomiri.service.d/override.conf'
    - name: 'command'
      command: 'echo "TimeoutStartSec=infinity" >> /etc/systemd/user/lomiri.service.d/override.conf'
    - name: 'command'
      command: 'echo "[User]" > /var/lib/AccountsService/users/ubuntu'
    - name: 'command'
      command: 'echo "Background=/usr/share/backgrounds/warty-final-lomiri.png" > /var/lib/AccountsService/users/ubuntu'

    - name: 'ubiquity-remove'

artifacts:
    - type: 'iso'
      name: 'ubuntu-lomiri.iso'
